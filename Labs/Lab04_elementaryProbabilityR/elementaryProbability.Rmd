---
output:
  html_document: default
  pdf_document: default
---


# Lab 3: Elementary Probability in R


You will do all your work for this lab in the `console`; so you won't need to touch the `.Rmd` file for this lab.

We'll use the built-in `Titanic` dataset for several questions in this lab

```{r,echo = FALSE}
library(knitr)
```


Load in the `tidyverse` library. Also, run `install.packages("janitor")` and then `library(janitor)`. In your console, type `Titanic`. The `Titanic` dataset displays. To view the dataset, run `view(Titanic)` in the console. You can also learn more about this dataset by running `?Titanic` in the console


First, lets get some practice making contingency tables using `dplyr`. To do so, we'll need to make sure `Titanic` is a `data.frame` object. Run `class(Titanic)` in the console; notice it is a `table` object. Convert it to a `data.frame` object by putting `Titanic = data.frame(Titanic)` in the console, and then running that line. We also recommend setting `N = sum(Titanic$Freq)` in the console. This will store the total number of individuals on the `Titanic` in the variable `N`.

We'll also do some preprocessing on the `Titanic` dataset to make it easier to use in conjunction with the contingency table functions available in `R`. Run the following line in the `console` to update `Titanic`
```{r,eval = FALSE}
Titanic = as.data.frame(lapply(Titanic,rep,Titanic$Freq))

```

Now run the following line in the console:
```{r,eval=FALSE}
Titanic %>%
  tabyl(Age,Survived) %>%
  adorn_totals(c("row","col")) %>%
  adorn_percentages("all") %>%
  adorn_ns

```
The syntax `x %>% f(.,OTHER_ARGS)` feeds `x` into function `f` in the position where the `.` is located (the first argument). The `%>%` is called the `pipe` in R. So `tabyl` takes as its first argument `Titanic`. In this setting, `taybl` creates a contingency table based on the two variables `Age` and `Survived`. The `adorn_totals` function gives row and column totals respectively. The `adorn_percentages` function will put the marginal percentages next to each count. The `adorn_ns` function ensures that both the counts and percentages display.

The `%>%` is from the `magrittr` library which loads autmoatically when you run `library(tidyverse)`. The `tabyl` function is from the `janitor` package.

If you are ever need help using the `tabyl` function, see [here](https://cran.r-project.org/web/packages/janitor/vignettes/tabyls.html). See [here](https://r4ds.had.co.nz/pipes.html) for more information on the `pipe` operator.

## Question 1: Learning Outcome -- Using `tabyl` to Construct a Contingency Table

Write code to produce a 3 x 2 table of `Class` against `Survived`. Run it. Store the newly created data frame as a variable in your working environment. Now answer question 1 on Canvas.


## Question 2: Learning Outcome -- Assessing whether events are independent

Let `A` be the event `Being a Member of 1st Class on Titanic`. Let `B` be the event `Surviving the Titanic`. Are the events `A` and `B` independent?

Hint: Use the table you constructed in question 1

## Question 3: Learning Outcome -- Assessing whether events are mutually exclusive

Let `A` be the event `First class child or second class child`. Let `B` be the event `DIED on the Titanic`. Are the events `A` and `B` mutually exclusive?

Hint: Run the below lines to create a table that `filters` by First or Second class child, and displays the total frequency of Survived, and Died.
```{r,eval = FALSE}
#Assuming you have set Titanic = data.frame(Titanic) in your environment
Titanic %>%
  filter((Class == "1st" | Class == "2nd") & Age == "Child") %>%
  group_by(Survived) %>%
  summarise(n = sum(Freq))

```

## Question 4: Learning Outcome -- Mututal Exclusivity vs Independence

Based on your answer to question 3, are the events `First class child or second class child` and `DIED on the Titanic` independent events?


## Question 5: Learning Outcome -- Using the Addition Rule

Let `A` be the event `Surviving the Titanic` and `B` be the event `Being a member of 3rd class`. Find $P(A \cup B)$.

Hint: The table you created in question 1 may be helpful

## READ

Suppose that in the population that was the 2021 class of CS 3130 students, the event of `X = Getting an A on the First Exam` and `Y = Liking Cilantro` are under study. We collected the corresponding 2x2 table with these two variables for the entire class of 200 students.


`Scott: Maybe we should focus on titanic or cilantro but not both....`


## Question 6: Learning Outcome -- Determining Independence from a Population 2x2 Table
```{r,echo=FALSE}
population = data.frame('Got A' = c(60,40,100), 'Did Not Get A' = c(40,60,100),'Total' = c(100,100,200))
row.names(population) = c('Likes Cilantro','Does Not Like Cilantro','Total')
kable(population)
```

Are `Getting an A on the First exam` and `Liking Cilantro` independent in the population of 2021 CS 3130 students?

## READ

Now suppose Albert had no idea whether `Getting an A on the First exam` and `Liking Cilantro` were independent in the population of 2021 CS 3130 students. He wanted to determine this. 

So he collected information from a simple random sample of 12 students and arranged the data into a table like the following:


```{r,echo=FALSE}
sample = data.frame('Got A' = c(4,3,7), 'Did Not Get A' = c(4,1,5),'Total' = c(8,4,12))
row.names(sample) = c('Likes Cilantro','Does Not Like Cilantro','Total')
```

```{r,echo=FALSE}
kable(sample)
```

The above table wasn't Albert's table, but Albert's table had the same margins as the above table. For now we'll just focus on the above table.


Let's assume now that we knew apriori that any sample from the population would have $8$ people that `Liked Cilantro` and $7$ people that `Got an A`. Given this sampling constraint, we'll compute the probability of the above table, and revisit Albert's table later.

We can a logic similar to that which we used in combinations/permutations and "overcounting" to count up all of the different ways to get this table, and then divided by the factor by which we overcount.

- How many ways can we arrange the 8 folks who Like Cilantro, *taking order into account*?
- How many ways can we arrange the 4 who don't?
- And the 7 who got As?
- And the 5 who did not?

Note that each of these arrangements is a "different choice" in some sense.  So we can use the multiplication rule to combine them.

- How many ways can we arrange the 8 folks who like cilantro, the 4 who don't, the 7 who got As and the 5 who didn't, all taking order into account?

However, some of these arrangements "overcount" w.r.t. our goal of creating a contingency table with this exact layout.  Specifically, when we arranged our cilantro-likers, we counted the various arrangments of the 4 who got "A"s, but when we arranged the folks who got "A"s, we AGAIN counted the arrangements of those same 4.  So, we have overcounted by a factor of "the number of ways to arrange 4 people".  Calculate "the number of ways to arrange" the number of people in each cell of the contingency table above, and divide the answer to Q? by this number.

- How many ways can we get a contingency table with 8 folks who like cilantro, 4 who don't, 7 who got As, 5 who didn't, 4 "A" students who liked cilantro, 3 "A" students who didn't, 4 non-"A" students who liked cilantro, and 1 non-"A" student who didn't?

- How many ways can we order 12 students?

Divide your answer in Q? by your answer to Q? to get the probability of getting our specific contingency table given that $8$ folks liked cilantro and $7$ got an "A".

## Question 7: Learning Outcome: Computing the Probability of a Table

What is the probability of this table?
```{r,echo=FALSE}
sample = data.frame('Got A' = c(4,3,7), 'Did Not Get A' = c(4,1,5),'Total' = c(8,4,12))
row.names(sample) = c('Likes Cilantro','Does Not Like Cilantro','Total')
```

```{r,echo=FALSE}
kable(sample)
```

## READ

Suppose again that there are $8$ people that `Liked Cilantro` and $7$ people that Got an `A`. There are only $8$ possible tables. This is because if we know these margins and specify the upper left cell (or any cell), then the table is determined. And based on the margins, the upper left cell can only take on the values $0,1,2,3,4,5,6,7$. You already computed the probability when the upper left cell is $4$.

Denoting $P(Table = i | margins, independence)$ as the conditional probability the upper left cell is $i$ given these margins and given that `Getting A` and `Liking Cilantro` are independent of one another, we can compute for $i=0,1,2,3,4,5,6,7$ $P(Table = i| margins)$. The probabilities are as follows:

```{r,echo=FALSE}
vec = 0:7
computeProb <- function(i) {
  return(choose(8,i)*choose(4,7-i))
}
probs = sapply(vec,computeProb)
probs = probs/sum(probs)
frame = data.frame(i = 0:7,prob = probs)
kable(frame)
```
These probabilities were computed just like you did in problem $7$. We can call this the distribution of the tables *under the null hypothesis of assuming independence between Getting an A and Liking Cilantro*.

Now recall Albert from a while back, he collected a table with these margins; he wanted to use his table to decide if in the population at large, `Getting and A` and `Liking Cilantro` were independent. His table is given below:

```{r,echo=FALSE}
sample = data.frame('Got A' = c(7,0,7), 'Did Not Get A' = c(1,4,5),'Total' = c(8,4,12))
row.names(sample) = c('Likes Cilantro','Does Not Like Cilantro','Total')
kable(sample)
```

## Question 8: Learning Outcome - The Probability of Albert's Table

What is the probability of Albert's table under the assumption of these margins and the assumption of independence between `Getting an A` and `Liking Cilantro`.

## Question 9: Learning Outcome - The Probability of a More Extreme Result Than Albert's

What is the probability of getting an upper left cell greater than or equal to the upper left cell given in Albert's table, under the assumption of independence between `Getting an A` and `Liking Cilantro` (and assuming these margins)

## Question 10: Learning Outcome - Making a Decision For Albert

Remember that the probabilities you computed in questions 8 and 9 were under the assumption of independence of `Getting an A` and `Liking Cilantro`. Suppose for a moment that you were Albert, and you never knew that in the population `Getting an A` and `Liking Cilantro` were independent. Also suppose that you would be willing to reject the *hypothesis of independence* if the probability of the table being as extreme or more extreme than what was observed by Albert is below $.05$. Do you reject the *hypothesis of independence*?


